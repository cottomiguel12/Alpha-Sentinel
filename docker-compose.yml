services:

  sentinel-api:
    build:
      context: .
      dockerfile: Dockerfile.api
    working_dir: /app
    env_file:
      - .env 
      - .secrets.env
    environment:
      DB_PATH: /data/sentinel.db
      LOG_PATH: /logs/sentinel.log
      API_PORT: "8001"
    volumes:
      - ./data:/data
      - sentinel_logs:/logs
    networks: [core_net]
    restart: unless-stopped
    ports:
      - "127.0.0.1:8001:8001"

  sentinel-agent:
    build:
      context: .
      dockerfile: Dockerfile.agent
    working_dir: /app
    env_file: [.env]
    environment:
      DB_PATH: /data/sentinel.db
      LOG_PATH: /logs/agent.log
      OPTIONS_CSV: /data/options-flow-02-15-2026.csv
      AGENT_INTERVAL_SEC: "1.5"
      MAX_ALERTS_PER_TICK: "25"
      REPLAY_FROM_START: "0"
      WATCHLIST_REFRESH_SEC: "5"
    volumes:
      - ./data:/data
      - ./config:/app/config:ro
      - sentinel_logs:/logs
    networks: [core_net]
    restart: unless-stopped
    depends_on: [sentinel-api]

networks:
  core_net:
    external: true

volumes:
  sentinel_data:
  sentinel_logs:
